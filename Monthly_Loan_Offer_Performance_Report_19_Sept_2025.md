# üìä Monthly Loan Offer Performance Report

**Analysis Date**: September 19, 2025
**Analyst**: Risk DA Intern
**Status**: ‚úÖ **COMPLETED**

---

## üéØ **Executive Summary**

This document details the creation of the monthly loan offer performance report, a key dataset for the **Propensity Loan Take Up 2025** project. The objective was to generate a time-series summary of the loan offer funnel, providing a clear view of total offers versus successful take-ups from January to August 2025.

The analysis successfully produced a monthly breakdown of key metrics. The core of this task involved developing a robust SQL query that accurately defines a "take-up" event by linking customer offers in the LFS system to new facilities in the LP system. The query also includes special logic to handle a known data anomaly in April 2025, ensuring the report's accuracy.

### **Key Achievements**:
-   **End-to-End Report Generation**: A single, reusable SQL query was built to produce the final monthly summary.
-   **Accurate Take-up Logic**: Implemented the business definition of "take-up" (`start_date` within the offer validity period).
-   **Anomaly Handled**: The query successfully corrects for the Eid holiday data shift that affected the April 2025 offer data.

---

## üìà **Final Report Summary**

The query generates a monthly summary of the loan offer funnel. The grand total for the analysis period (Jan-Aug 2025, excluding Oct-Dec 2024) is as follows:

| Metric | Grand Total |
| :--- | :--- |
| Total Offer | **419,465** |
| Total Take-up | **11,368** |
| Total Has Facility | **11,368** |
| **Take-up / Offer %** | **2.71 %** |

### **Example Monthly Breakdown (2025-08-31)**

| Metric | Value |
| :--- | :--- |
| Total Offer | 52,929 |
| Total Take-up | 1,486 |
| Take-up / Offer % | 2.81 % |

---

## ‚öôÔ∏è **Query Methodology**

The report was generated using a comprehensive SQL query that aggregates data on a monthly basis. The methodology is broken down into several key logical steps within Common Table Expressions (CTEs).

1.  **Isolate Latest Offers (`latest_offers`)**: For each month, the query first identifies the single most recent and valid loan offer for every customer using `QUALIFY DENSE_RANK()`. This prevents double-counting.

2.  **Identify Customer Cohorts (`latest_offers_customer`, `facilities_customer`)**: The query creates two main groups of customers:
    *   **Offer Cohort**: LFS customers who received an offer.
    *   **Facility Cohort**: LP customers who have an active `FJDL` loan facility.

3.  **Link Offers to Facilities (`final`)**: A `LEFT JOIN` is performed to connect the **Offer Cohort** to the **Facility Cohort**.
    *   **Join Key**: The link is critically made using `id_number` (KTP), successfully bridging the two separate customer systems (LFS and LP).
    *   **Take-up Flag**: A `flag_takeup` is generated by checking if a customer's facility `start_date` falls between their offer's `created_at` and `expires_at` dates.

4.  **Aggregate and Finalize (`final_base1`, `final_base2`)**:
    *   The data is grouped by month to `SUM()` the total offers and take-ups.
    *   An important exclusion filter (`WHERE id_number NOT IN ...`) is applied to remove customers who already have a facility but did not take up the *current* offer, creating a cleaner cohort for analysis.

5.  **Handle April Anomaly**: A separate, identical set of logic (`offer_aprl` through `final_base2`) is used to process April 2025 data, which was affected by an offer date shift due to the Eid holiday.

6.  **Combine Results**: A `UNION ALL` merges the results from the main query and the April-specific query into the final, complete report.

---

## üè∑Ô∏è **Tags**

`#monthly-report` `#loan-offer` `#take-up-rate` `#propensity-model` `#data-aggregation` `#sql` `#risk-analytics`
